function facebookfillFormMerge(response) {
    if (response.status != 'connected') {
        return;
    }

    FB.api('/me?fields=id,first_name,last_name,gender,birthday,email,token_for_business', function(user_response) {

        $('<input/>', {
            'type'  : 'hidden',
            'name'  : 'oauth[provider_access_token]'
        }).val(response.authResponse.accessToken).appendTo("#merge_form");

        $('<input/>', {
            'type'  : 'hidden',
            'name'  : 'oauth[provider]'
        }).val('facebook').appendTo("#merge_form");

        $('<input/>', {
            'type'  : 'hidden',
            'name'  : 'oauth[provider_app_id]'
        }).val(FACEBOOK_APP_ID).appendTo("#merge_form");

        $('<input/>', {
            'type'  : 'hidden',
            'name'  : 'oauth[provider_id]'
        }).val(user_response.token_for_business).appendTo("#merge_form");

    });
}

function facebookfillFormUserData(response) {
    if (response.status != 'connected') {
        return;
    }

    FB.api('/me?fields=id,first_name,last_name,gender,birthday,email,token_for_business', function(user_response) {
        $('<input/>', {
            'type'  : 'hidden',
            'name'  : 'oauth[provider_access_token]'
        }).val(response.authResponse.accessToken).appendTo("#form-register");

        $('<input/>', {
            'type'  : 'hidden',
            'name'  : 'oauth[provider]'
        }).val('facebook').appendTo("#form-register");

        $('<input/>', {
            'type'  : 'hidden',
            'name'  : 'oauth[provider_app_id]'
        }).val(FACEBOOK_APP_ID).appendTo("#form-register");

        $('<input/>', {
            'type'  : 'hidden',
            'name'  : 'oauth[provider_id]'
        }).val(user_response.token_for_business).appendTo("#form-register");

        $('input[name="email"]').val(user_response.email);
        $('input[name="email"]').focus();

        $('input[name="name"]').val(user_response.first_name);
        $('input[name="name"]').focus();

        $('input[name="surname"]').val(user_response.last_name);
        $('input[name="surname"]').focus();

        if (user_response.gender) {
            $('select[name="gender"]').val(user_response.gender);
        }

        if (user_response.birthday) {
            var birthday = user_response.birthday.split('/');
            $('select[name="dateofbirth[day]"]').val(parseInt(birthday[1]));
            $('select[name="dateofbirth[month]"]').val(parseInt(birthday[0]));
            $('select[name="dateofbirth[year]"]').val(parseInt(birthday[2]));
        };

        $('input[name="nick"]').focus();
    });
}


function facebookCreateUser(virtual_fair_id) {
    window.location.href = base_url + '/user/register?virtual_fair_id='+virtual_fair_id;
}

function facebookMerge(email, virtual_fair_id) {
    $.get(base_url + '/content/facebook-merge',
        {'virtual_fair_id':virtual_fair_id, 'email':email},
        function(html) {
            $('#popup-generic').find('.popup-wrapper').html(html);
            openPopup('generic');
        });
}

function facebookLogin() {
    FB.login(
        function(response) {
            if (response.status == undefined) {
                return;
            };

            var virtual_fair_id = $('[name="virtual_fair_id"]').val();

            var fb_data = {
                'id' : response.authResponse.userID,
                'access_token' : response.authResponse.accessToken,
                'virtual_fair_id' : virtual_fair_id
            };

            FB.api('/me?fields=id,first_name,last_name,gender,birthday,email,token_for_business', function(response) {

                if (response.email != undefined) {
                    fb_data.email = response.email;
                }

                if (response.token_for_business != undefined) {
                    fb_data.id = response.token_for_business;
                }

                $.post(base_url + '/facebook/authenticate', fb_data, function (data) {

                    if (data.status == 'logged') {
                        if (data.virtual_fair_id) {
                            closePopupRegister();
                            doSubscribe(data.virtual_fair_id);
                        }
                    } else if (data.status == 'merge') {
                        facebookMerge(fb_data.email, virtual_fair_id);
                    } else if (data.status == 'create'){
                        facebookCreateUser(virtual_fair_id);
                    } else if (data.status == 'authentication_failed') {
                        alert(data.message);
                    }

                }, 'json');
            });
        },
        {
            scope: 'email,public_profile,user_birthday',
            auth_type: 'rerequest'
        }
    );
}

//# sourceMappingURL=facebook-login.min.js.map
